---
- name: Install debootstrap
  ansible.builtin.shell:
    cmd: |
      pacman -S --noconfirm debootstrap

- name: Perform bootstrap
  ansible.builtin.shell:
    cmd: |
      debootstrap \
        --arch=amd64 \
        --variant=minbase \
        {{ debian_code_name }} \
        /mnt

- name: Configure sources.list
  ansible.builtin.copy:
    content: |
      deb https://mirror.csclub.uwaterloo.ca/debian {{ debian_code_name }} main contrib non-free
    dest: /etc/apt/sources.list
    mode: 0644
    owner: root
    group: root

- name: Install base packages
  ansible.builtin.shell:
    cmd: |
      arch-chroot /mnt apt -y {{ command }}
  loop:
    - update
    - upgrade
    - install {{ debian_base_packages | join(' ') }}
  env:
    DEBIAN_FRONTEND: noninteractive
